<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.springboard.mapper.ReplyMapper">

	<insert id="insert">

		insert into tbl_reply (bno, reply, replyer)
		values ( #{bno}, #{reply}, #{replyer})

	</insert>

	<select id="read" resultType="org.springboard.domain.ReplyVO">

		select * from tbl_reply where rno = #{rno}

	</select>

	<delete id="delete">

		delete from tbl_reply where rno = #{rno}

	</delete>
	
	<update id="update">

		update tbl_reply set reply = #{reply}, updatedate = current_timestamp() where rno =
		#{rno}

	</update>

	<select id="getListWithPaging"
		resultType="org.springboard.domain.ReplyVO">
		
		<![CDATA[
		select sub1.rno, sub1.bno, sub1.reply, sub1.replyer, sub1.replyDate, sub1.updatedate
		from
		(
			select 
				sub2.rn, sub2.bno, sub2.rno, sub2.reply, sub2.replyer, sub2.replyDate, sub2.updatedate
			from (
				select
					ROW_NUMBER() OVER (order by rno desc) as rn, bno, rno, reply, replyer, replyDate, updatedate
				from
					tbl_reply
					where bno = #{bno}
				) sub2
			where sub2.rno > 0
			and sub2.rn <= #{cri.pageNum} * #{cri.amount}
		) sub1
		where sub1.rn > (#{cri.pageNum} -1) * #{cri.amount}
		]]>
	</select>
	
	<select id="getCountByBno" resultType="int">
		
		<![CDATA[
		select count(rno) from tbl_reply where bno = #{bno}
		]]>
		
	</select>
</mapper>